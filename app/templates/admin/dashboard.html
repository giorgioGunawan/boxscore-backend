<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NBA Boxscore Admin</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #12121a;
            --bg-card: #1a1a24;
            --bg-hover: #22222e;
            --accent-orange: #ff6b35;
            --accent-blue: #4ecdc4;
            --accent-purple: #a855f7;
            --accent-green: #22c55e;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border: #2d2d3a;
            --shadow: 0 4px 24px rgba(0, 0, 0, 0.4);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            background-image: 
                radial-gradient(ellipse at 20% 0%, rgba(255, 107, 53, 0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 100%, rgba(78, 205, 196, 0.06) 0%, transparent 50%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-blue));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .logo h1 {
            font-size: 1.75rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary), var(--text-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo span {
            font-size: 0.875rem;
            color: var(--text-muted);
            font-weight: 400;
        }

        .season-badge {
            background: var(--bg-card);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--accent-blue);
            border: 1px solid var(--border);
        }

        .input-group {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-wrap: wrap;
        }

        select, input[type="text"], input[type="number"] {
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9375rem;
            min-width: 180px;
            cursor: pointer;
        }

        input[type="number"] {
            width: 80px;
            min-width: 80px;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--accent-orange);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.25rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            color: var(--text-primary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: var(--bg-hover);
            border-color: var(--accent-orange);
            transform: translateY(-2px);
        }

        .action-btn.small {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }

        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success { border-color: var(--accent-green); }
        .toast.error { border-color: var(--accent-red); }

        /* API Tester Section */
        .api-tester {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .api-tester h3 {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .api-tester h3 .method {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            background: rgba(78, 205, 196, 0.2);
            color: var(--accent-blue);
        }

        .result-container {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            border: 1px solid var(--border);
        }

        .result-container.show {
            display: block;
        }

        .result-container pre {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8125rem;
            color: var(--text-secondary);
            white-space: pre-wrap;
            word-break: break-word;
        }

        .result-container .error {
            color: var(--accent-red);
        }

        .result-container .loading {
            color: var(--text-muted);
            font-style: italic;
        }

        .api-path {
            background: var(--bg-primary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .api-path .method-badge {
            background: rgba(78, 205, 196, 0.2);
            color: var(--accent-blue);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .api-path .path {
            color: var(--accent-orange);
            flex: 1;
        }

        .api-path .copy-btn {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .api-path .copy-btn:hover {
            border-color: var(--accent-blue);
            color: var(--accent-blue);
        }

        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
            padding-bottom: 1rem;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .tab.active {
            background: var(--accent-orange);
            border-color: var(--accent-orange);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Widget Styles */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        .widget {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.25rem;
            border: 1px solid var(--border);
        }

        .widget-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .widget-title .badge {
            background: var(--accent-orange);
            color: white;
            padding: 0.15rem 0.4rem;
            border-radius: 4px;
            font-size: 0.65rem;
        }

        /* Widget 1: Next Games */
        .next-games-widget .team-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .next-games-widget .team-abbr {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .next-games-widget .team-record {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            color: var(--text-muted);
        }

        .next-games-widget .game-row {
            display: flex;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        .next-games-widget .game-row:last-child {
            border-bottom: none;
        }

        .next-games-widget .game-vs {
            color: var(--text-muted);
            width: 25px;
        }

        .next-games-widget .game-opponent {
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
        }

        .next-games-widget .game-opponent-record {
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            margin-left: 0.5rem;
        }

        .next-games-widget .game-datetime {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        /* Widget 2: Season Average */
        .season-avg-widget .player-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .season-avg-widget .player-name {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .season-avg-widget .player-number {
            background: var(--accent-orange);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .season-avg-widget .stats-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
        }

        .season-avg-widget .stat {
            background: var(--bg-secondary);
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
        }

        .season-avg-widget .stat-value {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .season-avg-widget .stat-label {
            color: var(--text-muted);
            font-size: 0.7rem;
        }

        /* Widget 3: Last Results */
        .last-results-widget .result-row {
            display: flex;
            align-items: center;
            padding: 0.6rem 0;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        .last-results-widget .result-row:last-child {
            border-bottom: none;
        }

        .last-results-widget .result-teams {
            flex: 1;
        }

        .last-results-widget .result-score {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
        }

        .last-results-widget .result-score.win {
            color: var(--accent-green);
        }

        .last-results-widget .result-score.loss {
            color: var(--accent-red);
        }

        .last-results-widget .result-date {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-muted);
            font-size: 0.8rem;
            margin-left: 1rem;
        }

        /* Widget 4: Team Standing */
        .team-standing-widget .team-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.75rem;
        }

        .team-standing-widget .standing-info {
            display: flex;
            align-items: baseline;
            gap: 1rem;
        }

        .team-standing-widget .record {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.75rem;
            font-weight: 700;
        }

        .team-standing-widget .rank {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Widget 5: Player Last Game */
        .player-last-game-widget .player-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .player-last-game-widget .player-name {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .player-last-game-widget .player-number {
            background: var(--accent-orange);
            color: white;
            padding: 0.2rem 0.4rem;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .player-last-game-widget .stats-line {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            margin-bottom: 0.5rem;
        }

        .player-last-game-widget .stats-line .stat-value {
            color: var(--accent-blue);
            font-weight: 600;
        }

        .player-last-game-widget .game-result {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .player-last-game-widget .game-result .score {
            font-weight: 600;
        }

        /* Widget 6: Countdown */
        .countdown-widget .matchup {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
            text-align: center;
        }

        .countdown-widget .matchup .vs {
            color: var(--text-muted);
            font-weight: 400;
            margin: 0 0.5rem;
        }

        .countdown-widget .countdown-display {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1rem;
        }

        .countdown-widget .countdown-item {
            text-align: center;
        }

        .countdown-widget .countdown-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent-orange);
        }

        .countdown-widget .countdown-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .countdown-widget .game-datetime {
            text-align: center;
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.75rem;
        }

        .widget-controls {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .widget-controls h3 {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--border);
            border-top-color: var(--accent-orange);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container { padding: 1rem; }
            header { flex-direction: column; gap: 1rem; align-items: flex-start; }
            .tabs { flex-wrap: wrap; }
            .widgets-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üèÄ</div>
                <div>
                    <h1>Boxscore Admin</h1>
                    <span>NBA Data Management Console</span>
                </div>
            </div>
            <div class="season-badge">Season {{ settings.current_season }}</div>
        </header>

        <!-- Tabs Navigation -->
        <div class="tabs">
            <button class="tab active" data-tab="widgets">üì± Widgets</button>
            <button class="tab" data-tab="api-tester">üß™ API Tester</button>
            <button class="tab" data-tab="cache-metrics">‚ö° Cache & Metrics</button>
        </div>

        <!-- Widgets Tab -->
        <div class="tab-content active" id="tab-widgets">
            <!-- Widget Controls -->
            <div class="widget-controls">
                <h3>üéÆ Widget Preview Controls</h3>
                <div class="input-group">
                    <select id="widget-team">
                        {% for team in teams %}
                        <option value="{{ team.id }}" data-abbr="{{ team.abbreviation }}" {% if team.abbreviation == 'GSW' %}selected{% endif %}>{{ team.name }} ({{ team.abbreviation }})</option>
                        {% endfor %}
                    </select>
                    <input type="number" id="widget-player-id" value="201939" placeholder="NBA Player ID" style="width: 150px;">
                    <button class="action-btn small" onclick="loadAllWidgets()">
                        <span class="icon">üîÑ</span> Load Widgets
                    </button>
                </div>
                <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    üí° Default: GSW + Stephen Curry (201939). Change team/player and click Load.
                </p>
            </div>

            <!-- Widgets Grid -->
            <div class="widgets-grid">
                <!-- Widget 1: Next 3 Games -->
                <div class="widget next-games-widget" id="widget-next-games">
                    <div class="widget-title"><span class="badge">1</span> Next 3 Games</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>

                <!-- Widget 2: Season Average -->
                <div class="widget season-avg-widget" id="widget-season-avg">
                    <div class="widget-title"><span class="badge">2</span> Season Average</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>

                <!-- Widget 3: Last 3 Results -->
                <div class="widget last-results-widget" id="widget-last-results">
                    <div class="widget-title"><span class="badge">3</span> Last 3 Results</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>

                <!-- Widget 4: Team Standing -->
                <div class="widget team-standing-widget" id="widget-standing">
                    <div class="widget-title"><span class="badge">4</span> Team Standing</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>

                <!-- Widget 5: Player Last Game -->
                <div class="widget player-last-game-widget" id="widget-player-last">
                    <div class="widget-title"><span class="badge">5</span> Player Last Game</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>

                <!-- Widget 6: Countdown -->
                <div class="widget countdown-widget" id="widget-countdown">
                    <div class="widget-title"><span class="badge">6</span> Countdown to Next Game</div>
                    <div class="widget-content">
                        <div class="loading-spinner"></div> Loading...
                    </div>
                </div>
            </div>
        </div>

        <!-- API Tester Tab -->
        <div class="tab-content" id="tab-api-tester">
            <!-- Teams API -->
            <div class="api-tester">
                <h3><span class="method">GET</span> Teams API</h3>
                <div class="input-group">
                    <select id="teams-endpoint">
                        <option value="list">List All Teams</option>
                        <option value="by-id">Get Team by ID</option>
                        <option value="by-abbr">Get Team by Abbreviation</option>
                        <option value="next-games">Next Games</option>
                        <option value="last-games">Last Games</option>
                        <option value="standings">Team Standings</option>
                        <option value="conference">Conference Standings</option>
                        <option value="roster">Team Roster</option>
                    </select>
                    <select id="teams-team-select" style="display:none;">
                        <option value="">Select team...</option>
                        {% for team in teams %}
                        <option value="{{ team.id }}" data-abbr="{{ team.abbreviation }}">{{ team.name }} ({{ team.abbreviation }})</option>
                        {% endfor %}
                    </select>
                    <input type="text" id="teams-abbr-input" placeholder="e.g. GSW" style="display:none; width:100px;">
                    <select id="teams-conference" style="display:none;">
                        <option value="East">Eastern</option>
                        <option value="West">Western</option>
                    </select>
                    <input type="number" id="teams-count" value="5" min="1" max="20" style="display:none;">
                    <button class="action-btn small" onclick="testTeamsAPI()">
                        <span class="icon">‚ñ∂Ô∏è</span> Run
                    </button>
                </div>
                <div class="api-path">
                    <span class="method-badge">GET</span>
                    <span class="path" id="teams-api-path">/api/teams</span>
                    <button class="copy-btn" onclick="copyPath('teams-api-path')">üìã Copy</button>
                </div>
                <div class="result-container" id="teams-result">
                    <pre></pre>
                </div>
            </div>

            <!-- Players API -->
            <div class="api-tester">
                <h3><span class="method">GET</span> Players API</h3>
                <div class="input-group">
                    <select id="players-endpoint">
                        <option value="search">Search Players</option>
                        <option value="info">Player Info</option>
                        <option value="season-averages">Season Averages</option>
                        <option value="latest-game">Latest Game</option>
                    </select>
                    <input type="text" id="players-search" placeholder="Search name (e.g. curry, lebron)..." style="width:220px;">
                    <input type="number" id="players-nba-id" placeholder="NBA Player ID (e.g. 201939)" style="display:none; width:200px;">
                    <button class="action-btn small" onclick="testPlayersAPI()">
                        <span class="icon">‚ñ∂Ô∏è</span> Run
                    </button>
                </div>
                <div class="api-path">
                    <span class="method-badge">GET</span>
                    <span class="path" id="players-api-path">/api/players/search?name={name}</span>
                    <button class="copy-btn" onclick="copyPath('players-api-path')">üìã Copy</button>
                </div>
                <p id="players-hint" style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
                    üí° Search for a player to find their NBA ID. Use that ID directly for stats endpoints.
                </p>
                <div class="result-container" id="players-result">
                    <pre></pre>
                </div>
            </div>

            <!-- Common NBA Player IDs Reference -->
            <div class="api-tester">
                <h3><span class="method">REF</span> Common NBA Player IDs</h3>
                <div style="font-family: 'JetBrains Mono', monospace; font-size: 0.8rem; color: var(--text-secondary); line-height: 1.8;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem;">
                        <span>Stephen Curry: <strong style="color: var(--accent-blue);">201939</strong></span>
                        <span>LeBron James: <strong style="color: var(--accent-blue);">2544</strong></span>
                        <span>Kevin Durant: <strong style="color: var(--accent-blue);">201142</strong></span>
                        <span>Jayson Tatum: <strong style="color: var(--accent-blue);">1628369</strong></span>
                        <span>Luka Donƒçiƒá: <strong style="color: var(--accent-blue);">1629029</strong></span>
                        <span>Giannis: <strong style="color: var(--accent-blue);">203507</strong></span>
                        <span>Nikola Jokiƒá: <strong style="color: var(--accent-blue);">203999</strong></span>
                        <span>Joel Embiid: <strong style="color: var(--accent-blue);">203954</strong></span>
                    </div>
                </div>
                <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem;">
                    üí° Use these IDs directly in your Swift app! Players are auto-created on first request.
                </p>
            </div>
        </div>

        <!-- Cache & Metrics Tab -->
        <div class="tab-content" id="tab-cache-metrics">
            <div class="api-tester">
                <h3>üìä Cache Metrics</h3>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-top: 1rem;">
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-blue);" id="cache-hits">0</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">CACHE HITS</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-orange);" id="cache-misses">0</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">CACHE MISSES</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-purple);" id="upstream-calls">0</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">API CALLS</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 1rem; border-radius: 8px; text-align: center;">
                        <div style="font-size: 1.5rem; font-weight: 600; color: var(--accent-green);" id="hit-rate">0%</div>
                        <div style="font-size: 0.75rem; color: var(--text-muted);">HIT RATE</div>
                    </div>
                </div>
            </div>

            <div class="api-tester">
                <h3>üóÑÔ∏è Database Stats</h3>
                <div class="result-container show" id="db-stats-result">
                    <pre>Loading...</pre>
                </div>
                <button class="action-btn" style="margin-top: 1rem;" onclick="loadDbStats()">
                    <span class="icon">üîÑ</span>
                    <span>Refresh Stats</span>
                </button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <script>
        const API_BASE = '/api';

        // Tab switching
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
            });
        });

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toast-message');
            toast.className = `toast ${type} show`;
            toastMessage.textContent = message;
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function copyPath(elementId) {
            const path = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(path);
            showToast('Path copied to clipboard!');
        }

        // =====================
        // WIDGET FUNCTIONS
        // =====================

        async function loadAllWidgets() {
            const teamId = document.getElementById('widget-team').value;
            const playerId = document.getElementById('widget-player-id').value;
            
            loadNextGamesWidget(teamId);
            loadSeasonAvgWidget(playerId);
            loadLastResultsWidget(teamId);
            loadStandingWidget(teamId);
            loadPlayerLastGameWidget(playerId);
            loadCountdownWidget(teamId);
        }

        async function loadNextGamesWidget(teamId) {
            const container = document.querySelector('#widget-next-games .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const [gamesData, standingData] = await Promise.all([
                    fetch(`${API_BASE}/teams/${teamId}/next-games?count=3`).then(r => r.json()),
                    fetch(`${API_BASE}/teams/${teamId}/standings`).then(r => r.json())
                ]);
                
                const teamAbbr = document.querySelector('#widget-team option:checked').dataset.abbr;
                const record = `${standingData.wins}-${standingData.losses}`;
                
                let html = `
                    <div class="team-header">
                        <span class="team-abbr">${teamAbbr}</span>
                        <span class="team-record">(${record})</span>
                    </div>
                `;
                
                for (const game of gamesData.games) {
                    const date = new Date(game.date + 'T' + game.time);
                    const dateStr = date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
                    const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                    const vsAt = game.is_home ? 'vs' : '@';
                    
                    html += `
                        <div class="game-row">
                            <span class="game-vs">${vsAt}</span>
                            <span class="game-opponent">${game.opponent}</span>
                            <span class="game-datetime">${dateStr} ${timeStr}</span>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        async function loadSeasonAvgWidget(playerId) {
            const container = document.querySelector('#widget-season-avg .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const data = await fetch(`${API_BASE}/players/${playerId}/season-averages`).then(r => r.json());
                
                container.innerHTML = `
                    <div class="player-header">
                        <span class="player-name">${data.player_name}</span>
                        <span class="player-number">30</span>
                    </div>
                    <div class="stats-row">
                        <div class="stat"><span class="stat-value">${data.ppg}</span><span class="stat-label">ppg</span></div>
                        <div class="stat"><span class="stat-value">${data.apg}</span><span class="stat-label">apg</span></div>
                        <div class="stat"><span class="stat-value">${data.rpg}</span><span class="stat-label">rpg</span></div>
                        <div class="stat"><span class="stat-value">${data.bpg}</span><span class="stat-label">bpg</span></div>
                        <div class="stat"><span class="stat-value">${data.spg}</span><span class="stat-label">spg</span></div>
                        <div class="stat"><span class="stat-value">${data.fg_pct}%</span><span class="stat-label">fg</span></div>
                        <div class="stat"><span class="stat-value">${data.fg3_pct}%</span><span class="stat-label">3fg</span></div>
                        <div class="stat"><span class="stat-value">${data.ft_pct}%</span><span class="stat-label">ft</span></div>
                    </div>
                `;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        async function loadLastResultsWidget(teamId) {
            const container = document.querySelector('#widget-last-results .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const data = await fetch(`${API_BASE}/teams/${teamId}/last-games?count=3`).then(r => r.json());
                const teamAbbr = document.querySelector('#widget-team option:checked').dataset.abbr;
                
                let html = '';
                for (const game of data.games) {
                    const date = new Date(game.date);
                    const dateStr = date.toLocaleDateString('en-US', { day: 'numeric', month: 'short' });
                    const isWin = game.result === 'W';
                    const scoreClass = isWin ? 'win' : 'loss';
                    
                    html += `
                        <div class="result-row">
                            <span class="result-teams">${teamAbbr} vs ${game.opponent}</span>
                            <span class="result-score ${scoreClass}">${game.team_score} - ${game.opponent_score}</span>
                            <span class="result-date">${dateStr}</span>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        async function loadStandingWidget(teamId) {
            const container = document.querySelector('#widget-standing .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const data = await fetch(`${API_BASE}/teams/${teamId}/standings`).then(r => r.json());
                const teamAbbr = document.querySelector('#widget-team option:checked').dataset.abbr;
                
                container.innerHTML = `
                    <div class="team-name">${teamAbbr}</div>
                    <div class="standing-info">
                        <span class="record">${data.wins}-${data.losses}</span>
                        <span class="rank">${data.conference_rank_display} in ${data.conference}</span>
                    </div>
                `;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        async function loadPlayerLastGameWidget(playerId) {
            const container = document.querySelector('#widget-player-last .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const data = await fetch(`${API_BASE}/players/${playerId}/latest-game`).then(r => r.json());
                
                container.innerHTML = `
                    <div class="player-header">
                        <span class="player-name">${data.player_name}</span>
                        <span class="player-number">30</span>
                    </div>
                    <div class="stats-line">
                        <span class="stat-value">${data.pts}</span>pt 
                        <span class="stat-value">${data.reb}</span>rb 
                        <span class="stat-value">${data.ast}</span>as 
                        vs ${data.opponent}
                    </div>
                    <div class="game-result">
                        ${data.game_date}
                    </div>
                `;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        async function loadCountdownWidget(teamId) {
            const container = document.querySelector('#widget-countdown .widget-content');
            container.innerHTML = '<div class="loading-spinner"></div> Loading...';
            
            try {
                const data = await fetch(`${API_BASE}/teams/${teamId}/next-games?count=1`).then(r => r.json());
                const teamAbbr = document.querySelector('#widget-team option:checked').dataset.abbr;
                
                if (data.games.length === 0) {
                    container.innerHTML = 'No upcoming games';
                    return;
                }
                
                const game = data.games[0];
                const gameDate = new Date(game.date + 'T' + game.time);
                const now = new Date();
                const diff = gameDate - now;
                
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                const dateStr = gameDate.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const timeStr = gameDate.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
                
                const matchup = game.is_home ? `${game.opponent} vs ${teamAbbr}` : `${teamAbbr} @ ${game.opponent}`;
                
                container.innerHTML = `
                    <div class="matchup">${matchup}</div>
                    <div class="countdown-display">
                        <div class="countdown-item">
                            <div class="countdown-value">${days}</div>
                            <div class="countdown-label">Days</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value">${hours}</div>
                            <div class="countdown-label">Hours</div>
                        </div>
                        <div class="countdown-item">
                            <div class="countdown-value">${mins}</div>
                            <div class="countdown-label">Mins</div>
                        </div>
                    </div>
                    <div class="game-datetime">${dateStr} at ${timeStr}</div>
                `;
            } catch (e) {
                container.innerHTML = `<span style="color: var(--accent-red);">Error: ${e.message}</span>`;
            }
        }

        // =====================
        // API TESTER FUNCTIONS
        // =====================

        function updateTeamsApiPath() {
            const endpoint = document.getElementById('teams-endpoint').value;
            const teamId = document.getElementById('teams-team-select').value || '{team_id}';
            const abbr = document.getElementById('teams-abbr-input').value || '{abbr}';
            const conference = document.getElementById('teams-conference').value;
            const count = document.getElementById('teams-count').value;
            
            let path = '/api/teams';
            switch(endpoint) {
                case 'list': path = '/api/teams'; break;
                case 'by-id': path = `/api/teams/${teamId}`; break;
                case 'by-abbr': path = `/api/teams/abbr/${abbr.toUpperCase() || '{ABBR}'}`; break;
                case 'next-games': path = `/api/teams/${teamId}/next-games?count=${count}`; break;
                case 'last-games': path = `/api/teams/${teamId}/last-games?count=${count}`; break;
                case 'standings': path = `/api/teams/${teamId}/standings`; break;
                case 'conference': path = `/api/teams/standings/${conference}`; break;
                case 'roster': path = `/api/teams/${teamId}/roster`; break;
            }
            document.getElementById('teams-api-path').textContent = path;
        }

        function updatePlayersApiPath() {
            const endpoint = document.getElementById('players-endpoint').value;
            const searchName = document.getElementById('players-search').value || '{name}';
            const nbaId = document.getElementById('players-nba-id').value || '{nba_player_id}';
            
            let path = '/api/players/search?name={name}';
            switch(endpoint) {
                case 'search': path = `/api/players/search?name=${encodeURIComponent(searchName)}`; break;
                case 'info': path = `/api/players/${nbaId}/info`; break;
                case 'season-averages': path = `/api/players/${nbaId}/season-averages`; break;
                case 'latest-game': path = `/api/players/${nbaId}/latest-game`; break;
            }
            document.getElementById('players-api-path').textContent = path;
        }

        document.getElementById('teams-endpoint').addEventListener('change', function() {
            const teamSelect = document.getElementById('teams-team-select');
            const abbrInput = document.getElementById('teams-abbr-input');
            const conferenceSelect = document.getElementById('teams-conference');
            const countInput = document.getElementById('teams-count');
            
            teamSelect.style.display = 'none';
            abbrInput.style.display = 'none';
            conferenceSelect.style.display = 'none';
            countInput.style.display = 'none';
            
            switch(this.value) {
                case 'by-id':
                case 'next-games':
                case 'last-games':
                case 'standings':
                case 'roster':
                    teamSelect.style.display = 'block';
                    if (this.value === 'next-games' || this.value === 'last-games') {
                        countInput.style.display = 'block';
                    }
                    break;
                case 'by-abbr':
                    abbrInput.style.display = 'block';
                    break;
                case 'conference':
                    conferenceSelect.style.display = 'block';
                    break;
            }
            updateTeamsApiPath();
        });

        document.getElementById('teams-team-select').addEventListener('change', updateTeamsApiPath);
        document.getElementById('teams-abbr-input').addEventListener('input', updateTeamsApiPath);
        document.getElementById('teams-conference').addEventListener('change', updateTeamsApiPath);
        document.getElementById('teams-count').addEventListener('input', updateTeamsApiPath);

        document.getElementById('players-endpoint').addEventListener('change', function() {
            const searchInput = document.getElementById('players-search');
            const nbaIdInput = document.getElementById('players-nba-id');
            const hint = document.getElementById('players-hint');
            
            searchInput.style.display = 'none';
            nbaIdInput.style.display = 'none';
            
            switch(this.value) {
                case 'search':
                    searchInput.style.display = 'block';
                    hint.textContent = 'üí° Search for a player to find their NBA ID.';
                    break;
                case 'info':
                case 'season-averages':
                case 'latest-game':
                    nbaIdInput.style.display = 'block';
                    hint.textContent = 'üí° Enter NBA Player ID (e.g. 201939 for Curry).';
                    break;
            }
            updatePlayersApiPath();
        });

        document.getElementById('players-search').addEventListener('input', updatePlayersApiPath);
        document.getElementById('players-nba-id').addEventListener('input', updatePlayersApiPath);

        function showResult(containerId, data, isError = false) {
            const container = document.getElementById(containerId);
            const pre = container.querySelector('pre');
            container.classList.add('show');
            
            if (isError) {
                pre.innerHTML = `<span class="error">${JSON.stringify(data, null, 2)}</span>`;
            } else {
                pre.textContent = JSON.stringify(data, null, 2);
            }
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            const pre = container.querySelector('pre');
            container.classList.add('show');
            pre.innerHTML = '<span class="loading">Loading...</span>';
        }

        async function apiCall(endpoint, method = 'GET') {
            const response = await fetch(`${API_BASE}${endpoint}`, { method });
            const data = await response.json();
            if (!response.ok) throw { status: response.status, ...data };
            return data;
        }

        async function testTeamsAPI() {
            const endpoint = document.getElementById('teams-endpoint').value;
            const teamId = document.getElementById('teams-team-select').value;
            const abbr = document.getElementById('teams-abbr-input').value;
            const conference = document.getElementById('teams-conference').value;
            const count = document.getElementById('teams-count').value;
            
            showLoading('teams-result');
            
            try {
                let url;
                switch(endpoint) {
                    case 'list': url = '/teams'; break;
                    case 'by-id':
                        if (!teamId) throw { detail: 'Please select a team' };
                        url = `/teams/${teamId}`; break;
                    case 'by-abbr':
                        if (!abbr) throw { detail: 'Please enter abbreviation' };
                        url = `/teams/abbr/${abbr.toUpperCase()}`; break;
                    case 'next-games':
                        if (!teamId) throw { detail: 'Please select a team' };
                        url = `/teams/${teamId}/next-games?count=${count}`; break;
                    case 'last-games':
                        if (!teamId) throw { detail: 'Please select a team' };
                        url = `/teams/${teamId}/last-games?count=${count}`; break;
                    case 'standings':
                        if (!teamId) throw { detail: 'Please select a team' };
                        url = `/teams/${teamId}/standings`; break;
                    case 'conference':
                        url = `/teams/standings/${conference}`; break;
                    case 'roster':
                        if (!teamId) throw { detail: 'Please select a team' };
                        url = `/teams/${teamId}/roster`; break;
                }
                
                const data = await apiCall(url);
                showResult('teams-result', data);
            } catch (e) {
                showResult('teams-result', e, true);
            }
        }

        async function testPlayersAPI() {
            const endpoint = document.getElementById('players-endpoint').value;
            const searchName = document.getElementById('players-search').value;
            const nbaPlayerId = document.getElementById('players-nba-id').value;
            
            showLoading('players-result');
            
            try {
                let url;
                switch(endpoint) {
                    case 'search':
                        if (!searchName || searchName.length < 2) throw { detail: 'Enter at least 2 characters' };
                        url = `/players/search?name=${encodeURIComponent(searchName)}`; break;
                    case 'info':
                        if (!nbaPlayerId) throw { detail: 'Please enter NBA Player ID' };
                        url = `/players/${nbaPlayerId}/info`; break;
                    case 'season-averages':
                        if (!nbaPlayerId) throw { detail: 'Please enter NBA Player ID' };
                        url = `/players/${nbaPlayerId}/season-averages`; break;
                    case 'latest-game':
                        if (!nbaPlayerId) throw { detail: 'Please enter NBA Player ID' };
                        url = `/players/${nbaPlayerId}/latest-game`; break;
                }
                
                const data = await apiCall(url);
                showResult('players-result', data);
            } catch (e) {
                showResult('players-result', e, true);
            }
        }

        async function updateMetrics() {
            try {
                const data = await fetch(`${API_BASE}/admin/metrics`).then(r => r.json());
                document.getElementById('cache-hits').textContent = data.cache.hits;
                document.getElementById('cache-misses').textContent = data.cache.misses;
                document.getElementById('upstream-calls').textContent = data.cache.upstream_calls;
                document.getElementById('hit-rate').textContent = data.cache.hit_rate_pct + '%';
            } catch (e) {
                console.error('Failed to update metrics:', e);
            }
        }

        async function loadDbStats() {
            try {
                const data = await apiCall('/admin/stats');
                showResult('db-stats-result', data);
            } catch (e) {
                showResult('db-stats-result', e, true);
            }
        }

        // Initial load
        loadAllWidgets();
        loadDbStats();
        setInterval(updateMetrics, 10000);
    </script>
</body>
</html>
